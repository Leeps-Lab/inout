<link
    rel="import"
    href="/static/bower_components/polymer/polymer.html" />
<link
    rel="import"
    href="/static/webcomponents/inout/payout-graph.html" />

<dom-module id="in-out">
    <template>
        <div id="strategy_info">
            <span id="choice"> /1</span> <span id="static_text"> in your group chose</span> <span id="choice"> </span>
        </div>
        <div id="payoff">
            Your current pay off is {{ gameData }} ; cumlative is  
        </div>
        <div id="graphs">
            <payout-graph
                data='[[ gameData ]]'
                game-Constant='[[ c ]]'>
            </payout-graph>
        </div>

        <br>

        <button
            type="button"
            value=true
            on-tap="_changeStatus"
            class="choiceButton">
            IN
        </button>
        <button
            type="button"
            value=false
            on-tap="_changeStatus"
            class="choiceButton">
            OUT
        </button>
    </template>   
    
    <script>
        Polymer({
            is: 'in-out',
            properties: {
                gameData:{
                    type: Array,
                },
                isIn:{
                    type: Boolean,
                    value: false,
                },
                c: {
                    type: Number,
                },
                _x_t:{
                    type: Number,

                },
                _a_sto:{
                    type: Number,
                },
                _noise:{
                    type: Number,
                },
                _startingTime:{
                    type: Number,
                },
                
            },
            ready() {
                console.log("in-out.html");
                this.async(this._setStartingTime, 1);
            },
            _setStartingTime() {
                this._startingTime = Date.now();
                console.log(this._startingTime);
                this._tick();
            },
            _changeStatus(e){
                this.isIn = e.target.value;
                console.log(this.isIn);
            },
            _generateA() {
                this._a_sto = Math.random();
                console.log(this._a_sto);
            },
            _generateNoise() {
                return 0;
            },
            _generateX_t() {
                // index = this._calculateTime();
                this._generateA();
                this._generateNoise();

                this._x_t = ((this._a_sto * this._x_t) + this._noise);

                //this.gameData.push([index, this._x_t]);
            },
            _calculateTime() {
                tempNow = (Date.now() / 1000);
                tempBegin = (this._startingTime / 1000);
                timeNow = tempNow - tempBegin;


                return timeNow;
            },
            _tick() {
                index = this._calculateTime();
                if(this.isIn){
                    this._generateX_t();
                    // this.gameData.push([index, this._x_t]);
                    this._updateGraph([index, this._x_t]);
                    console.log("isIn: true");
                } else {
                    console.log("isIn: false");
                    // this.gameData.push([index, this.c]);
                    this._updateGraph([index, this.c]);

                }

                if(timeNow > 60){
                    window.clearTimeout(this.timeout);
                    console.log("Killed");
                } else {
                    // console.log("gameData: " + this.gameData);
                    console.log("pushed data: [" + index + "," + this.c + "]");
                    this.timeout = window.setTimeout(this._tick.bind(this), 2000);
                }


            },
            _updateGraph(data) {
                let graph = Polymer.dom(this.root).querySelectorAll('payoff-graph');

                graph.addData(data);
            }

        });
    </script>

</dom-module>